<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension
         id="product"
         point="org.eclipse.core.runtime.products">
      <product
            application="org.yamcs.studio.core.application"
            name="Yamcs Studio">
         <property
               name="windowImages"
               value="icons/css16.png,icons/css32.png,icons/css48.png,icons/css64.png,icons/css128.png,icons/css256.png"/>
         <property
               name="aboutText"
               value="CS-Studio customized to suit Yamcs - The Open Source Mission Control System&#x0A;&#x0A;See http://www.yamcs.org"/>
         <property
               name="aboutImage"
               value="icons/aboutSide.png"/>
         <property
               name="appName"
               value="Yamcs Studio"/>
         <property
               name="applicationXMI"
               value="platform:/plugin/org.yamcs.studio.core/Application.e4xmi"/>
         <property
               name="lifeCycleURI"
               value="bundleclass://org.yamcs.studio.core/org.yamcs.studio.core.application.LifeCycleManager"/>
         <property
               name="cssTheme"
               value="org.eclipse.e4.ui.css.theme.e4_default"/>
         <property
               name="applicationCSSResources"
               value="platform:/plugin/org.eclipse.platform/images/"/>
         <property
               name="startupForegroundColor"
               value="2F376D"/>
         <property
               name="startupMessageRect"
               value="20,195,560,20"/>
         <property
               name="startupProgressRect"
               value="20,215,560,15"/>
         <property
               name="preferenceCustomization"
               value="plugin_customization.ini"/>
         <property
            name="introTitle"
            value="Yamcs Studio"/>
         <property
            name="introBrandingImage"
            value="product:icons/css64.png"/>
         <property
            name="introBrandingImageText"
            value="Yamcs Studio"/>
      </product>
   </extension>
   
   <extension
         point="org.eclipse.core.runtime.applications"
         id="application"
		 name="Yamcs Studio">
      <application>
         <run
               class="org.csstudio.startup.application.Application">
         </run>
      </application>
   </extension>
   
   <extension
         point="org.eclipse.ui.perspectives">
      <perspective
            class="org.yamcs.studio.core.application.YamcsPerspective"
            icon="icons/css16.png"
            id="org.yamcs.studio.core.application.YamcsPerspective"
            name="Yamcs">
      </perspective>
   </extension>
   
   <extension
         id="postfragmentmodelprocessor"
         point="org.eclipse.e4.workbench.model">
      <processor
            beforefragment="false"
            class="org.yamcs.studio.core.application.PostFragmentModelProcessor"/>
   </extension>
   
   <!-- Note that the classes listed in here should be in plugins
        that can be loaded without locking the workspace.
        This means the plugins loaded for these classes
        should not use preferences or anything else that
        triggers initialization of the workspace
     -->
   <extension point="org.csstudio.startup.module">
      <startupParameters class="org.csstudio.utility.product.StartupParameters"/>
      <workspace class="org.csstudio.utility.product.WorkspacePrompt"/>
      <workbench class="org.yamcs.studio.core.application.Workbench"/>
      <project class="org.yamcs.studio.core.application.DefaultYamcsStudioProject"/>
   </extension>

<!--   <extension
         point="org.eclipse.ui.activities">
    <activity id="yamcsstudio.disablextensions" name="Hidden activities"/>
    <activityPatternBinding activityId="yamcsstudio.disablextensions" pattern="org.eclipse.team.*"/>
   </extension-->
   
   <!--
   	This extension point is actually considered deprecated now, in favor of the
   	"common navigator framework". We'll use this one until we have time to figure
   	out the other one.
   -->
   <extension point="org.eclipse.ui.ide.resourceFilters">
      
      <!-- Hide files that should by default be hidden (.project, .pydevproject, ..) -->
      <filter
            selected="true"
            pattern=".**"> <!-- Not using .* because that one is declared by org.eclipse.ui.ide as selected="false" -->
      </filter>
   </extension>
   
   <extension
         point="org.eclipse.ui.startup">
      <startup
            class="org.yamcs.studio.core.pvmanager.Bootstrap"/>
   </extension>
   
   <extension
         point="org.eclipse.ui.preferencePages">
      <page
            class="org.yamcs.studio.core.ui.prefs.YamcsPreferencePage"
            id="org.yamcs.studio.core.ui.prefs.YamcsPreferencePage"
            name="Yamcs">
      </page>
   </extension>
   
   <extension
         point="org.eclipse.ui.services">
      <!-- This one provides the workbench state for the RefreshArchive command
           because we don't want the user to refresh again while a fetch is already in progress -->
      <sourceProvider
            provider="org.yamcs.studio.core.archive.RefreshCommandState">
         <variable
               name="org.yamcs.studio.core.archive.state.refreshEnabled"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <!-- Workbench state for the ZoomIn command -->
      <sourceProvider
            provider="org.yamcs.studio.core.archive.ZoomInCommandState">
         <variable
               name="org.yamcs.studio.core.archive.state.zoomInEnabled"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <!-- Workbench state for the ZoomOut command -->
      <sourceProvider
            provider="org.yamcs.studio.core.archive.ZoomOutCommandState">
         <variable
               name="org.yamcs.studio.core.archive.state.zoomOutEnabled"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <!-- Workbench state for the ZoomClear command -->
      <sourceProvider
            provider="org.yamcs.studio.core.archive.ZoomClearCommandState">
         <variable
               name="org.yamcs.studio.core.archive.state.zoomClearEnabled"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <!-- Workbench state for the Tag command -->
      <sourceProvider
            provider="org.yamcs.studio.core.archive.TagCommandState">
         <variable
               name="org.yamcs.studio.core.archive.state.tagEnabled"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
   </extension>
   
   <extension
         point="org.eclipse.ui.commands">
      <category
            id="org.csstudio"
            name="CSS">
      </category>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.commanding.issueTelecommandCommand"
            name="Issue Command">
      </command>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.archive.refreshCommand"
            name="Refresh">
      </command>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.archive.zoomInCommand"
            name="Zoom In">
      </command>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.archive.zoomOutCommand"
            name="Zoom Out">
      </command>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.archive.zoomClearCommand"
            name="Zoom all the way out">
      </command>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.archive.tagCommand"
            name="Annotate the selected range">
      </command>
      <command
            categoryId="org.csstudio"
            id="org.yamcs.studio.core.eventlog.clearCommand"
            name="Clear Log View">
      </command>
   </extension>
   
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="org.yamcs.studio.core.commanding.IssueCommandHandler"
            commandId="org.yamcs.studio.core.commanding.issueTelecommandCommand">
      </handler>
      <handler
            class="org.yamcs.studio.core.archive.RefreshHandler"
            commandId="org.yamcs.studio.core.archive.refreshCommand">
         <activeWhen>
            <with
                  variable="org.yamcs.studio.core.archive.state.refreshEnabled">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.core.archive.ZoomInHandler"
            commandId="org.yamcs.studio.core.archive.zoomInCommand">
         <activeWhen>
            <with
                  variable="org.yamcs.studio.core.archive.state.zoomInEnabled">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.core.archive.ZoomOutHandler"
            commandId="org.yamcs.studio.core.archive.zoomOutCommand">
         <activeWhen>
            <with
                  variable="org.yamcs.studio.core.archive.state.zoomOutEnabled">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.core.archive.ZoomClearHandler"
            commandId="org.yamcs.studio.core.archive.zoomClearCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.core.archive.state.zoomOutEnabled">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.core.archive.state.zoomClearEnabled">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.core.archive.TagHandler"
            commandId="org.yamcs.studio.core.archive.tagCommand">
         <activeWhen>
            <with
                  variable="org.yamcs.studio.core.archive.state.tagEnabled">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.core.eventlog.ClearHandler"
            commandId="org.yamcs.studio.core.eventlog.clearCommand">
      </handler>
   </extension>
   
   <extension
         point="org.eclipse.ui.views">
      <category
      		name="CSS"
      		id="org.csstudio">
      </category>
      <view
            category="org.csstudio"
            class="org.yamcs.studio.core.archive.ArchiveView"
            icon="icons/archive.png"
            id="org.yamcs.studio.core.archive.ArchiveView"
            name="Archive"/>
      <view
            category="org.csstudio"
            class="org.yamcs.studio.core.eventlog.EventLogView"
            icon="icons/event_log.gif"
            id="org.yamcs.studio.core.eventlog.EventLogView"
            name="Event Log"/>
      <view
            category="org.csstudio"
            class="org.yamcs.studio.core.commanding.TelecommandView"
            icon="icons/tc.png"
            id="org.yamcs.studio.core.commanding.TelecommandView"
            name="Telecommanding"/>
      <view
            category="org.csstudio"
            class="org.yamcs.studio.core.ui.TopView"
            id="org.yamcs.studio.core.ui.TopView"
            name="Replay Control"/>
   </extension>

   <extension
         point="org.eclipse.ui.perspectiveExtensions">
      <perspectiveExtension targetID="*">
         <!-- Don't need this, views are accessible through Window menu -->
         <hiddenMenuItem id="css"/>
         <!-- Don't need this, don't know many apps that do this. just quit and re-open -->
         <hiddenMenuItem id="org.csstudio.ui.menu.app.restart"/>
         <!-- Hide possiblity to jump to other perspectives that we unwillingly
              inherited from other plugin.xml's -->
         <hiddenMenuItem id="org.csstudio.ui.menu.app.open_perspective"/>
         <!-- This is only marginally useful and can be done by other means (ctrl-f / ctrl-h) -->
         <hiddenMenuItem id="textSearchSubMenu"/>
         <hiddenMenuItem id="org.eclipse.search.ui.openFileSearchPage"/>
         <!-- Already in menu which seems enough for this type of stuff -->
         <hiddenToolBarItem id="org.csstudio.security.login"/>
         <hiddenToolBarItem id="org.csstudio.security.logout"/>
         <hiddenToolBarItem id="org.csstudio.diag.pvmanager.probe.OpenProbe"/>
         <hiddenToolBarItem id="org.eclipse.search.OpenSearchDialogPage"/>
      </perspectiveExtension>
      
      <!-- Yamcs Perspective (might get rid of this eventually) -->
      <perspectiveExtension targetID="org.yamcs.studio.core.application.YamcsPerspective">
         <!-- Remove stuff that has to with files/selections -->
         <hiddenMenuItem id="org.csstudio.ui.menu.app.reopen_editors"/>
         <hiddenMenuItem id="org.csstudio.opibuilder.topfiles"/>
         <hiddenMenuItem id="org.eclipse.ui.edit.text.openLocalFile"/>
         <hiddenMenuItem id="org.eclipse.ui.newWizard"/>
         <hiddenMenuItem id="org.eclipse.ui.file.close"/>
         <hiddenMenuItem id="org.eclipse.ui.file.closeAll"/>
         <hiddenMenuItem id="org.eclipse.ui.file.save"/>
         <hiddenMenuItem id="org.eclipse.ui.file.saveAll"/>
         <hiddenMenuItem id="org.eclipse.ui.file.saveAs"/>
         <hiddenMenuItem id="org.eclipse.ui.file.import"/>
         <hiddenMenuItem id="org.eclipse.ui.file.export"/>
         <hiddenMenuItem id="org.eclipse.ui.edit.findReplace"/>
         <hiddenMenuItem id="org.eclipse.search.menu"/>
         <!-- Trying to keep this perspective editor-free -->
         <hiddenToolBarItem id="org.eclipse.ui.newWizard"/>
         <hiddenToolBarItem id="org.eclipse.ui.file.save"/>
         <hiddenToolBarItem id="org.csstudio.opibuilder.openTopFileAction"/>
      </perspectiveExtension>
      
      <!-- OPI Runtime Perspective -->
      <perspectiveExtension targetID="org.csstudio.opibuilder.OPIRuntime.perspective">
         <!-- Probably doesn't make sense in runtime perspective -->
         <hiddenMenuItem id="org.eclipse.ui.file.save"/>
         <hiddenMenuItem id="org.eclipse.ui.file.saveAll"/>
         <hiddenMenuItem id="org.eclipse.ui.file.saveAs"/>
         <hiddenMenuItem id="org.eclipse.ui.file.import"/>
         <hiddenMenuItem id="org.eclipse.ui.file.export"/>
         <hiddenMenuItem id="org.eclipse.search.menu"/>
         <hiddenMenuItem id="org.eclipse.ui.edit.findReplace"/>
         <!-- Trying to keep this perspective editor-free -->
         <hiddenToolBarItem id="org.eclipse.ui.newWizard"/>
         <hiddenToolBarItem id="org.eclipse.ui.file.save"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               closeable="false"
               id="org.yamcs.studio.core.archive.ArchiveView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               closeable="false"
               id="org.yamcs.studio.core.eventlog.EventLogView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               closeable="false"
               id="org.yamcs.studio.core.commanding.TelecommandView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.csstudio.diag.pvmanager.probe">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.csstudio.utility.sysmon.SysMonView">
         </view>
         <!-- Add view shortcuts too, because even with the closeable="false",
              it is still possible to close them (by first detaching them and
              then closing the detached window. Boooo -->
         <viewShortcut id="org.yamcs.studio.core.archive.ArchiveView"/>
         <viewShortcut id="org.yamcs.studio.core.eventlog.EventLogView"/>
         <viewShortcut id="org.yamcs.studio.core.commanding.TelecommandView"/>
         <!-- CS-Studio -->
         <viewShortcut id="org.csstudio.diag.pvmanager.probe"/>
         <viewShortcut id="org.csstudio.utility.sysmon.SysMonView"/>
      </perspectiveExtension>
      
      <!-- OPI Editor Perspective -->
      <perspectiveExtension targetID="org.csstudio.opibuilder.opieditor">
         <!-- Not very useful with the navigator already there -->
         <hiddenToolBarItem id="org.csstudio.opibuilder.openTopFileAction"/>
      	 <!-- Just some placeholders, in case the user wants to open this in the Editor -->
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.core.archive.ArchiveView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.core.eventlog.EventLogView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.core.commanding.TelecommandView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.csstudio.utility.pvmanager.ui.toolbox.FunctionsView">
         </view>
         <!-- Yamcs -->
         <viewShortcut id="org.yamcs.studio.core.archive.ArchiveView"/>
         <viewShortcut id="org.yamcs.studio.core.eventlog.EventLogView"/>
         <viewShortcut id="org.yamcs.studio.core.commanding.TelecommandView"/>
         <!-- CS-Studio -->
         <viewShortcut id="org.csstudio.utility.pvmanager.ui.toolbox.FunctionsView"/>
      </perspectiveExtension>
   </extension>
   
   <extension point="org.eclipse.ui.menus">
      <menuContribution
            allPopups="true"
            locationURI="toolbar:org.eclipse.ui.main.toolbar?after=file">
         <toolbar id="additions"/>
      </menuContribution>
      
      <!-- Add direct menu to switch perspectives (because we disable the horrible
           built-in perspective-switcher-bar) -->
      <!-- TODO rewrite this to use only one command, with a default checked radio state -->
      <menuContribution
            locationURI="menu:org.eclipse.ui.main.menu">
         <menu
               id="org.yamcs.studio.ui.perspectiveMenu"
               label="Perspective">
           	<command
                  commandId="org.eclipse.ui.perspectives.showPerspective"
                  icon="platform:/plugin/org.yamcs.studio.core/icons/css16.png"
                  label="Yamcs Dashboard"
                  style="radio">
               <parameter
                     name="org.eclipse.ui.perspectives.showPerspective.perspectiveId"
                     value="org.yamcs.studio.core.application.YamcsPerspective"/>
            </command>
            <command
                  commandId="org.eclipse.ui.perspectives.showPerspective"
                  icon="platform:/plugin/org.csstudio.opibuilder/icons/OPIBuilder.png"
                  label="OPI Editor"
                  style="radio">
               <parameter
                     name="org.eclipse.ui.perspectives.showPerspective.perspectiveId"
                     value="org.csstudio.opibuilder.opieditor"/>
            </command>
            <command
                  commandId="org.eclipse.ui.perspectives.showPerspective"
                  icon="platform:/plugin/org.csstudio.opibuilder/icons/OPIRunner.png"
                  label="OPI Runtime"
                  style="radio">
               <parameter
                     name="org.eclipse.ui.perspectives.showPerspective.perspectiveId"
                     value="org.csstudio.opibuilder.OPIRuntime.perspective"/>
            </command>
         </menu>
      </menuContribution>
      
      <!-- Add icon to the Telecommanding view toolbar -->
      <menuContribution
            locationURI="toolbar:org.yamcs.studio.core.commanding.TelecommandView">
         <command
               commandId="org.yamcs.studio.core.commanding.issueTelecommandCommand"
               icon="icons/tc_add.png"
               label="Issue Telecommand"
               style="push"/>
         <control class="org.yamcs.studio.core.ui.ToolbarSpacer"/>
      </menuContribution>
      
      <!-- Add icons to the Archive view toolbar -->
      <menuContribution
            locationURI="toolbar:org.yamcs.studio.core.archive.ArchiveView">
         <command
               commandId="org.yamcs.studio.core.archive.refreshCommand"
               icon="icons/refresh.gif"
               label="Refresh"
               style="push"/>
         <control class="org.yamcs.studio.core.ui.ToolbarSpacer"/>
         <command
               commandId="org.yamcs.studio.core.archive.zoomInCommand"
               icon="icons/zoom_in.png"
               label="Zoom In"
               style="push"/>
         <command
               commandId="org.yamcs.studio.core.archive.zoomOutCommand"
               icon="icons/zoom_out.png"
               label="Zoom Out"
               style="push"/>
         <command
               commandId="org.yamcs.studio.core.archive.zoomClearCommand"
               icon="icons/zoom_clear.png"
               label="Zoom all the way out"
               style="push"/>
         <control class="org.yamcs.studio.core.ui.ToolbarSpacer"/>
         <command
               commandId="org.yamcs.studio.core.archive.tagCommand"
               icon="icons/tag.gif"
               label="Annotate the selected range"
               style="push"/>
         <command
               commandId="org.yamcs.studio.core.archive.tagCommand"
               icon="icons/replay.png"
               label="Replay"
               style="push"/>
      </menuContribution>

      <!-- Add icons to the Event Log view toolbar -->
      <menuContribution
            locationURI="toolbar:org.yamcs.studio.core.eventlog.EventLogView">
         <command
               commandId="org.yamcs.studio.core.eventlog.clearCommand"
               icon="icons/clear.gif"
               label="Clear Log View"
               style="push"/>
      </menuContribution>
   </extension>
   
   <!-- 
   		vtype.pv datasource (for pvtable)
   		(only para:// at this moment, sw:// is pending)
    -->
   <extension point="org.csstudio.vtype.pv.pvfactory">
      <PVFactory name="Yamcs" class="org.yamcs.studio.core.vtype.pv.Para_PVFactory"/>
   </extension>
   
   <!--
   		pvmanager datasource
   	-->
   <extension
         point="org.csstudio.utility.pvmanager.datasource">
      <datasource
            datasource="org.yamcs.studio.core.pvmanager.ParameterDataSource"
            name="Yamcs Parameter"
            prefix="para">
      </datasource>
   </extension>
   <extension
         point="org.csstudio.utility.pvmanager.datasource">
      <datasource
            datasource="org.yamcs.studio.core.pvmanager.SoftwareParameterDataSource"
            name="Yamcs Software Parameter"
            prefix="sw">
      </datasource>
   </extension>
</plugin>
