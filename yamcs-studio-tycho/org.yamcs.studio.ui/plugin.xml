<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension
         id="product"
         point="org.eclipse.core.runtime.products">
      <product
            application="org.yamcs.studio.ui.application"
            name="Yamcs Studio">
         <property
               name="windowImages"
               value="icons/css16.png,icons/css32.png,icons/css48.png,icons/css64.png,icons/css128.png,icons/css256.png"/>
         <property
               name="aboutText"
               value="CS-Studio customized to suit Yamcs - The Open Source Mission Control System&#x0A;&#x0A;See http://www.yamcs.org"/>
         <property
               name="aboutImage"
               value="icons/aboutSide.png"/>
         <property
               name="appName"
               value="Yamcs Studio"/>
         <property
               name="lifeCycleURI"
               value="bundleclass://org.yamcs.studio.ui/org.yamcs.studio.ui.application.LifeCycleManager"/>
         <property
               name="applicationCSS"
               value="platform:/plugin/org.yamcs.studio.ui/css/default.css"/>
         <property
               name="applicationCSSResources"
               value="platform:/plugin/org.eclipse.platform/images/"/>
         <property
               name="startupForegroundColor"
               value="2F376D"/>
         <property
               name="startupMessageRect"
               value="20,195,560,20"/>
         <property
               name="startupProgressRect"
               value="20,215,560,15"/>
         <property
            name="introTitle"
            value="Yamcs Studio"/>
         <property
            name="introBrandingImage"
            value="product:icons/css64.png"/>
         <property
            name="introBrandingImageText"
            value="Yamcs Studio"/>
         <property
               name="preferenceCustomization"
               value="plugin_customization.ini">
         </property>
      </product>
   </extension>
   
   <extension
         point="org.eclipse.core.runtime.applications"
         id="application"
		 name="Yamcs Studio">
      <application>
         <run
               class="org.csstudio.startup.application.Application">
         </run>
      </application>
   </extension>
   
   <extension
         id="postfragmentmodelprocessor"
         point="org.eclipse.e4.workbench.model">
      <processor
            beforefragment="false"
            class="org.yamcs.studio.ui.application.PostFragmentModelProcessor"/>
   </extension>
   
   <!-- Note that the classes listed in here should be in plugins
        that can be loaded without locking the workspace.
        This means the plugins loaded for these classes
        should not use preferences or anything else that
        triggers initialization of the workspace
     -->
   <extension point="org.csstudio.startup.module">
      <startupParameters class="org.yamcs.studio.ui.application.StartupParameters"/>
      <workspace class="org.yamcs.studio.ui.application.WorkspacePrompt"/>
      <workbench class="org.yamcs.studio.ui.application.Workbench"/>
      <project class="org.yamcs.studio.ui.application.DefaultYamcsStudioProject"/>
   </extension>
   
   <extension point="org.eclipse.ui.activities">
      <activity id="yamcsstudio.disablextensions" name="Hidden activities"/>
      <activityPatternBinding activityId="yamcsstudio.disablextensions" pattern="org.eclipse.team.*"/>
   </extension>
   
   <!--
    This hides the 'Show PV Info' pop-up menu that appears when you right-click a PV in a display.
    We have our own richer modal for that.
   -->
   <extension point="org.eclipse.ui.activities">
      <activity id="yamcsstudio.hideShowPVInfo" name="Hide Show PV Info"/>
      <activityPatternBinding activityId="yamcsstudio.hideShowPVInfo" pattern="org.csstudio.opibuilder/org.csstudio.opibuilder.showPVInfoAction"/>
   </extension>
   
   <!--
   	This extension point is actually considered deprecated now, in favor of the
   	"common navigator framework". We'll use this one until we have time to figure
   	out the other one.
   -->
   <extension point="org.eclipse.ui.ide.resourceFilters">
      
      <!-- Hide files that should by default be hidden (.project, .pydevproject, ..) -->
      <filter
            selected="true"
            pattern=".**"> <!-- Not using .* because that one is declared by org.eclipse.ui.ide as selected="false" -->
      </filter>
   </extension>
   
   <extension point="org.eclipse.ui.preferencePages">
      <page
            class="org.csstudio.opibuilder.preferences.CommonPreferencePage"
            id="org.yamcs.studio.opibuilder.preferences"
            name="OPI Editor">
      </page>
      <page
            class="org.csstudio.opibuilder.preferences.OPIRuntimePreferencePage"
            id="org.yamcs.studio.opibuilder.preferences.opiruntime"
            name="OPI Runtime">
      </page>
   </extension>
   
   <extension point="org.eclipse.ui.services">   
      <sourceProvider provider="org.yamcs.studio.ui.AuthorizationStateProvider">
         <variable name="org.yamcs.studio.ui.authorization.mayCommandPayload" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.connections.ConnectionStateProvider">
         <variable name="org.yamcs.studio.ui.state.connected" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.archive.RefreshStateProvider">
         <variable name="org.yamcs.studio.ui.archive.state.refreshEnabled" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.archive.ZoomInStateProvider">
         <variable name="org.yamcs.studio.ui.archive.state.zoomInEnabled" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.archive.ZoomOutStateProvider">
         <variable name="org.yamcs.studio.ui.archive.state.zoomOutEnabled" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.archive.ClearZoomStateProvider">
         <variable name="org.yamcs.studio.ui.archive.state.zoomClearEnabled" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.archive.AnnotateRangeStateProvider">
         <variable name="org.yamcs.studio.ui.archive.state.tagEnabled" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.commanding.stack.CommandStackStateProvider">
         <variable name="org.yamcs.studio.ui.commanding.stack.state.remaining" priorityLevel="workbench" />
         <variable name="org.yamcs.studio.ui.commanding.stack.state.armed" priorityLevel="workbench" />
         <variable name="org.yamcs.studio.ui.commanding.stack.state.empty" priorityLevel="workbench" />
         <variable name="org.yamcs.studio.ui.commanding.stack.state.executionStarted" priorityLevel="workbench" />
      </sourceProvider>
      <sourceProvider provider="org.yamcs.studio.ui.processor.ProcessorStateProvider">
         <variable name="org.yamcs.studio.ui.processor.state.processing" priorityLevel="workbench" />
         <variable name="org.yamcs.studio.ui.processor.state.replay" priorityLevel="workbench" />
      </sourceProvider>
   </extension>
   
   <extension
         point="org.eclipse.ui.commands">
      <category
            id="org.yamcs.studio"
            name="Yamcs">
      </category>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.autoconnect"
            name="Autoconnect">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.connect"
            name="Connect">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.disconnect"
            name="Disconnect">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.goToBeginningCommand"
            name="Go to Beginning">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.reverseCommand"
            name="Step to Previous Update">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.pauseCommand"
            name="Pause">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.playCommand"
            name="Play">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.forwardCommand"
            name="Step to Next Update">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.goToEndCommand"
            name="Go to End">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.add"
            name="New Command">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.delete"
            name="Delete Command">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.deleteAll"
            name="Delete All Commands">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.skip"
            name="Skip Command">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.restart"
            name="Clear Execution State">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.arm"
            name="Arm Command">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.issue"
            name="Issue Command">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.export"
            name="Export Stack">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.stack.import"
            name="Import a Stack">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.cmdhist.clearCommand" 
            name="Clear View">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.commanding.cmdhist.scrollLockCommand" 
            name="Scroll Lock">
         <state
               class="org.eclipse.ui.handlers.RegistryToggleState:false"
               id="org.eclipse.ui.commands.toggleState" />
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.archive.refreshCommand"
            name="Refresh">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.archive.zoomInCommand"
            name="Zoom In">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.archive.zoomOutCommand"
            name="Zoom Out">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.archive.zoomClearCommand"
            name="Zoom all the way out">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.archive.createTagCommand"
            name="Annotate the selected range">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.archive.createReplayCommand"
            name="Create Replay">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.switch"
            name="Switch Processor">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.processor.leaveReplay"
            name="Leave Replay">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.eventlog.clearCommand"
            name="Clear View">
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.eventlog.scrollLockCommand" 
            name="Scroll Lock">
         <state
               class="org.eclipse.ui.handlers.RegistryToggleState:false"
               id="org.eclipse.ui.commands.toggleState" />
      </command>
      <command
            categoryId="org.yamcs.studio"
            id="org.yamcs.studio.ui.eventlog.importCommand"
            name="Import Events">
      </command>
      <command
            defaultHandler="org.yamcs.studio.ui.OpenPerspectiveHandler"
            id="org.yamcs.studio.ui.commands.openPerspectiveCommand"
            name="Open Perspective">
         <commandParameter
               id="org.eclipse.ui.commands.radioStateParameter"
               name="Perspective Parameter"
               optional="false"/>
         <state
               class="org.eclipse.ui.handlers.RadioState:org.csstudio.opibuilder.OPIRuntime.perspective"
               id="org.eclipse.ui.commands.radioState"/>
      </command>
   </extension>
   
   <extension point="org.eclipse.core.expressions.propertyTesters">
      <propertyTester
         namespace="org.yamcs.studio.ui.commanding.stack"
         class="org.yamcs.studio.ui.commanding.stack.StackedCommandPropertyTester"
         id="org.yamcs.studio.ui.commanding.stack.StackedCommandPropertyTester"
         properties="canBeSkipped"
         type="org.yamcs.studio.ui.commanding.stack.StackedCommand" />
   </extension>
   
   <extension point="org.eclipse.ui.handlers">
      <handler
            class="org.yamcs.studio.ui.commanding.stack.AddToStackHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.add">
         <activeWhen>
           
            <and>
            <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.authorization.mayCommandPayload">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.DeleteHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.delete">
         <enabledWhen>
            <with variable="selection">
               <and>
                  <count value="1" />
                  <iterate ifEmpty="false">
                     <instanceof value="org.yamcs.studio.ui.commanding.stack.StackedCommand"/>
                  </iterate>
               </and>
            </with>
         </enabledWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.DeleteAllHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.deleteAll">
         <enabledWhen>
            <with variable="org.yamcs.studio.ui.commanding.stack.state.empty">
               <not>
                  <equals value="true"/>
               </not>
            </with>
         </enabledWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.RestartHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.restart">
         <enabledWhen>
            <with variable="org.yamcs.studio.ui.commanding.stack.state.executionStarted">
               <equals value="true"/>
            </with>
         </enabledWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.SkipHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.skip">
         <enabledWhen>
            <and>
               <with variable="org.yamcs.studio.ui.commanding.stack.state.remaining">
                  <equals value="true"/>
               </with>
               <with variable="selection">
                  <and>
                     <count value="1" />
                     <iterate ifEmpty="false">
                        <adapt type="org.yamcs.studio.ui.commanding.stack.StackedCommand">
                           <test property="org.yamcs.studio.ui.commanding.stack.canBeSkipped" />
                        </adapt>
                     </iterate>
                  </and>
               </with>
            </and>
         </enabledWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.ArmCommandHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.arm">
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.IssueCommandHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.issue">
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.ExportCommandStackHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.export">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.commanding.stack.state.remaining">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.authorization.mayCommandPayload">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.stack.ImportCommandStackHandler"
            commandId="org.yamcs.studio.ui.commanding.stack.import">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.authorization.mayCommandPayload">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.cmdhist.ClearCommandHistoryHandler"
            commandId="org.yamcs.studio.ui.commanding.cmdhist.clearCommand">
      </handler>
      <handler
            class="org.yamcs.studio.ui.commanding.cmdhist.ScrollLockHandler"
            commandId="org.yamcs.studio.ui.commanding.cmdhist.scrollLockCommand">
      </handler>
      <handler
            class="org.yamcs.studio.ui.archive.RefreshArchiveHandler"
            commandId="org.yamcs.studio.ui.archive.refreshCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.archive.state.refreshEnabled">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.archive.ZoomInHandler"
            commandId="org.yamcs.studio.ui.archive.zoomInCommand">
         <activeWhen>
            <with variable="org.yamcs.studio.ui.archive.state.zoomInEnabled">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.archive.ZoomOutHandler"
            commandId="org.yamcs.studio.ui.archive.zoomOutCommand">
         <activeWhen>
            <with variable="org.yamcs.studio.ui.archive.state.zoomOutEnabled">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.archive.ZoomClearHandler"
            commandId="org.yamcs.studio.ui.archive.zoomClearCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.archive.state.zoomOutEnabled">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.archive.state.zoomClearEnabled">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.archive.AnnotateArchiveHandler"
            commandId="org.yamcs.studio.ui.archive.createTagCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.archive.state.tagEnabled">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.archive.CreateReplayHandler"
            commandId="org.yamcs.studio.ui.archive.createReplayCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.SwitchProcessorHandler"
            commandId="org.yamcs.studio.ui.processor.switch">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.LeaveReplayHandler"
            commandId="org.yamcs.studio.ui.processor.leaveReplay">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.eventlog.ImportEventsHandler"
            commandId="org.yamcs.studio.ui.eventlog.importCommand">
         <activeWhen>
            <with variable="org.yamcs.studio.ui.state.connected">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.eventlog.ClearEventLogHandler"
            commandId="org.yamcs.studio.ui.eventlog.clearCommand">
      </handler>
      <handler
            class="org.yamcs.studio.ui.eventlog.ScrollLockHandler"
            commandId="org.yamcs.studio.ui.eventlog.scrollLockCommand">
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.GoToBeginningHandler"
            commandId="org.yamcs.studio.ui.processor.goToBeginningCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <or>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="RUNNING"/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="PAUSED"/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="STOPPED"/>
                  </with>
               </or>
               <with variable="org.yamcs.studio.ui.processor.state.replay">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.ReverseHandler"
            commandId="org.yamcs.studio.ui.processor.reverseCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.processor.state.processing">
                  <equals value="RUNNING"/>
               </with>
               <with variable="org.yamcs.studio.ui.processor.state.replay">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.PauseHandler"
            commandId="org.yamcs.studio.ui.processor.pauseCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.processor.state.processing">
                  <equals value="RUNNING"/>
               </with>
               <with variable="org.yamcs.studio.ui.processor.state.replay">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.PlayHandler"
            commandId="org.yamcs.studio.ui.processor.playCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <or>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="PAUSED"/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="STOPPED"/>
                  </with>
               </or>
               <with variable="org.yamcs.studio.ui.processor.state.replay">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.ForwardHandler"
            commandId="org.yamcs.studio.ui.processor.forwardCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <with variable="org.yamcs.studio.ui.processor.state.processing">
                  <equals value="RUNNING"/>
               </with>
               <with variable="org.yamcs.studio.ui.processor.state.replay">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler
            class="org.yamcs.studio.ui.processor.GoToEndHandler"
            commandId="org.yamcs.studio.ui.processor.goToEndCommand">
         <activeWhen>
            <and>
               <with variable="org.yamcs.studio.ui.state.connected">
                  <equals value="true"/>
               </with>
               <or>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="RUNNING"/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="PAUSED"/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="STOPPED"/>
                  </with>
               </or>
               <with variable="org.yamcs.studio.ui.processor.state.replay">
                  <equals value="true"/>
               </with>
            </and>
         </activeWhen>
      </handler>
      <handler 
            commandId="org.yamcs.studio.ui.autoconnect" 
            class="org.yamcs.studio.ui.connections.AutoConnectHandler"/>
      <handler
            commandId="org.yamcs.studio.ui.connect"
            class="org.yamcs.studio.ui.connections.ConnectHandler"/>
      <handler
            commandId="org.yamcs.studio.ui.disconnect"
            class="org.yamcs.studio.ui.connections.DisconnectHandler">
         <activeWhen>
            <with variable="org.yamcs.studio.ui.state.connected">
               <equals value="true"/>
            </with>
         </activeWhen>
      </handler>
   </extension>
   
   <extension point="org.eclipse.ui.views">
      <category
      		name="Yamcs Server"
      		id="org.yamcs.studio.server">
      </category>
      <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.archive.ArchiveView"
            icon="icons/eview16/archive.png"
            id="org.yamcs.studio.ui.archive.ArchiveView"
            name="Archive"/>
      <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.eventlog.EventLogView"
            icon="icons/eview16/event_log.png"
            id="org.yamcs.studio.ui.eventlog.EventLogView"
            name="Event Log"/>
      <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView"
            icon="icons/eview16/tc.png"
            id="org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView"
            name="Command History"/>
      <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.commanding.stack.CommandStackView"
            icon="icons/eview16/tc_add.png"
            id="org.yamcs.studio.ui.commanding.stack.CommandStackView"
            name="Command Stack"/>
      <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.commanding.queue.CommandQueueView"
            icon="icons/eview16/tc_queue.png"
            id="org.yamcs.studio.ui.commanding.queue.CommandQueueView"
            name="Command Queues"/>   
       <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.links.LinksView"
            icon="icons/eview16/datalinks.png"
            id="org.yamcs.studio.ui.links.LinksView"
            name="Data Links"/>     
       <view
            category="org.yamcs.studio.server"
            class="org.yamcs.studio.ui.clients.ClientsView"
            icon="icons/eview16/clients.png"
            id="org.yamcs.studio.ui.clients.ClientsView"
            name="Connected Clients"/>            
            
   </extension>

   <extension
         point="org.eclipse.ui.perspectiveExtensions">
      <perspectiveExtension targetID="*">
         <!-- Don't need this, views are accessible through Window menu -->
         <hiddenMenuItem id="css"/>
         <!-- Don't need this, don't know many apps that do this. just quit and re-open -->
         <hiddenMenuItem id="org.csstudio.ui.menu.app.restart"/>
         <!-- Hide possiblity to jump to other perspectives that we unwillingly
              inherited from other plugin.xml's -->
         <hiddenMenuItem id="org.csstudio.ui.menu.app.open_perspective"/>
         <!-- This is only marginally useful and can be done by other means (ctrl-f / ctrl-h) -->
         <hiddenMenuItem id="textSearchSubMenu"/>
         <hiddenMenuItem id="org.eclipse.search.ui.openFileSearchPage"/>
         <!-- Already accessible from toolbar in Runtime perspective -->
         <hiddenMenuItem id="org.csstudio.opibuilder.topfiles"/>
         <!-- Already in menu which seems enough for this type of stuff -->
         <hiddenToolBarItem id="org.csstudio.security.login"/>
         <hiddenToolBarItem id="org.csstudio.security.logout"/>
         <hiddenToolBarItem id="org.eclipse.search.OpenSearchDialogPage"/>         
         <hiddenMenuItem id="org.csstudio.security.login"/>
         <hiddenMenuItem id="org.csstudio.security.logout"/>
         <!-- Looks weird with the '...' in the label. Want to replace to sth in file-menu instead, like eclipse -->
         <hiddenMenuItem id="org.csstudio.ui.menu.app.reopen_editors"/>
         <!-- Try to avoid confusion, perspectives already will open new windows -->
         <hiddenMenuItem id="org.eclipse.ui.window.newWindow"/>
         <!-- Hide this loaded help menu, with something simpler defined in action bar advisor -->
         <hiddenMenuItem id="help"/>
      </perspectiveExtension>
      
      <!-- OPI Runtime Perspective -->
      <perspectiveExtension targetID="org.csstudio.opibuilder.OPIRuntime.perspective">
         <!-- Probably doesn't make sense in runtime perspective -->
         <hiddenMenuItem id="org.eclipse.ui.newWizard"/>
         <hiddenMenuItem id="org.eclipse.ui.file.save"/>
         <hiddenMenuItem id="org.eclipse.ui.file.saveAll"/>
         <hiddenMenuItem id="org.eclipse.ui.file.saveAs"/>
         <hiddenMenuItem id="org.eclipse.ui.file.import"/>
         <hiddenMenuItem id="org.eclipse.ui.file.export"/>
         <hiddenMenuItem id="org.eclipse.search.menu"/>
         <hiddenMenuItem id="org.eclipse.ui.edit.findReplace"/>
         <!-- Trying to keep this perspective editor-free -->
         <hiddenToolBarItem id="org.eclipse.ui.newWizard"/>
         <hiddenToolBarItem id="org.eclipse.ui.file.save"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.archive.ArchiveView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.eventlog.EventLogView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.commanding.stack.CommandStackView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView">
         </view>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="right"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.links.LinksView">
         </view>
         <view
               relative="org.yamcs.studio.ui.links.LinksView"
               relationship="stack"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.clients.ClientsView">
         </view> 
         <view
               relative="org.yamcs.studio.ui.clients.ClientsView"
               relationship="stack"
               visible="true"
               closeable="true"
               id="org.yamcs.studio.ui.commanding.queue.CommandQueueView">
         </view>
         <viewShortcut id="org.yamcs.studio.ui.archive.ArchiveView"/>
         <viewShortcut id="org.yamcs.studio.ui.eventlog.EventLogView"/>
         <viewShortcut id="org.yamcs.studio.ui.commanding.stack.CommandStackView"/>
         <viewShortcut id="org.yamcs.studio.ui.commanding.queue.CommandQueueView"/>
         <viewShortcut id="org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView"/>
         <viewShortcut id="org.yamcs.studio.ui.links.LinksView"/>
         <viewShortcut id="org.yamcs.studio.ui.clients.ClientsView"/>
      </perspectiveExtension>
      
      <!-- OPI Editor Perspective -->
      <perspectiveExtension targetID="org.csstudio.opibuilder.opieditor">
         <!-- Not very useful with the navigator already there -->
         <hiddenToolBarItem id="org.csstudio.opibuilder.openTopFileAction"/>
         <hiddenToolBarItem id="org.yamcs.studio.toolbar.goToBeginningProcessor"/>
         <hiddenToolBarItem id="org.yamcs.studio.toolbar.reverseProcessor"/>
         <hiddenToolBarItem id="org.yamcs.studio.toolbar.pauseProcessor"/>
         <hiddenToolBarItem id="org.yamcs.studio.toolbar.forwardProcessor"/>
         <hiddenToolBarItem id="org.yamcs.studio.toolbar.goToEndProcessor"/>
         <hiddenToolBarItem id="org.yamcs.studio.toolbar.spacer40x32"/>
         <hiddenToolBarItem id="studiocontributions.processorInfo"/>
      	 <!-- Just some placeholders, in case the user wants to open this in the Editor -->
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.archive.ArchiveView"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.eventlog.EventLogView"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.commanding.stack.CommandStackView"/>
        <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.commanding.queue.CommandQueueView"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.csstudio.utility.pvmanager.ui.toolbox.FunctionsView"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.links.LinksView"/>
         <view
               relative="org.eclipse.ui.console.ConsoleView"
               relationship="stack"
               visible="false"
               id="org.yamcs.studio.ui.clients.ClientsView"/>
         <!-- Yamcs -->
         <viewShortcut id="org.yamcs.studio.ui.archive.ArchiveView"/>
         <viewShortcut id="org.yamcs.studio.ui.eventlog.EventLogView"/>
         <viewShortcut id="org.yamcs.studio.ui.commanding.stack.CommandStackView"/>
         <viewShortcut id="org.yamcs.studio.ui.commanding.queue.CommandQueueView"/>
         <viewShortcut id="org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView"/>
         <viewShortcut id="org.yamcs.studio.ui.links.LinksView"/>
         <viewShortcut id="org.yamcs.studio.ui.clients.ClientsView"/>
         <!-- CS-Studio -->
         <viewShortcut id="org.csstudio.utility.pvmanager.ui.toolbox.FunctionsView"/>
      </perspectiveExtension>
   </extension>
   
   <extension point="org.eclipse.ui.actionSets">
      <!-- Redefines the actionSet from the opibuilder plugin, so that we can customize it a bit -->
      <actionSet
            id="org.yamcs.studio.opibuilder.actionSet"
            label="Bookmark Actions"
            visible="true">
         <action
               class="org.yamcs.studio.ui.opibuilder.OpenFavouritesAction"
               id="org.csstudio.opibuilder.openTopFileAction"
               label="&#9733; Bookmarks"
               pulldown="true"
               style="pulldown"
               toolbarPath="studiocoolbar/bookmarkshortcuts"
               mode="FORCE_TEXT">
         </action>
         <action
               class="org.csstudio.opibuilder.actions.CompactModeAction"
               definitionId="org.csstudio.opibuilder.actions.compactMode"
               id="org.csstudio.opibuilder.compactModeAction"
               label="Compact Mode"
               style="push">
         </action>
         <action
               class="org.csstudio.opibuilder.actions.FullScreenAction"
               definitionId="org.csstudio.opibuilder.actions.fullscreen"
               id="org.csstudio.opibuilder.fullScreenAction"
               label="Full Screen"
               style="push">
         </action>
      </actionSet>
   </extension>
   
   <extension point="org.eclipse.ui.popupMenus">
      <objectContribution
            adaptable="false"
            id="org.yamcs.studio.showPVInfo"
            objectClass="org.csstudio.opibuilder.editparts.AbstractBaseEditPart">
         <action
               class="org.yamcs.studio.ui.opibuilder.ShowPVInfoAction"
               enablesFor="1"
               id="org.yamcs.studio.showPVInfoAction"
               label="Show PV Info"
               tooltip="Show details of PVs on this widget">
         </action>
         <visibility>
            <and>
               <objectState
                     name="executionMode"
                     value="RUN_MODE">
               </objectState>
               <objectState
                     name="hasPVs"
                     value="true">
               </objectState>
            </and>
         </visibility>
      </objectContribution>
   </extension>
   
   <extension point="org.eclipse.ui.menus">
      <menuContribution
            allPopups="true"
            locationURI="toolbar:org.eclipse.ui.main.toolbar?after=file">
         <toolbar id="additions"/>
      </menuContribution>
      
      <!-- Add direct menu to switch perspectives (because we disable the horrible
           built-in perspective-switcher-bar) -->
      <menuContribution locationURI="menu:window?after=additions">
       	 <separator name="start-of-perspectives" visible="true"/>
       	 <dynamic id="org.yamcs.studio.ui.menu.perspectiveItems" class="org.yamcs.studio.ui.OpenWindowsCompoundContributionItem"/>
       	 <separator name="end-of-perspectives" visible="true"/>
      </menuContribution>
      
       <menuContribution locationURI="toolbar:org.yamcs.studio.ui.commanding.stack.CommandStackView">
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.add"
                icon="icons/elcl16/new_command.png"
                disabledIcon="icons/dlcl16/new_command.png"
                label="New Command"
                style="push"/>
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.delete"
                icon="icons/elcl16/remove.png"
                disabledIcon="icons/dlcl16/remove.png"
                label="Delete Command"
                style="push"/>
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.deleteAll"
                icon="icons/elcl16/removeall.png"
                disabledIcon="icons/dlcl16/removeall.png"
                label="Delete All Commands"
                style="push"/>
          <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.skip"
                icon="icons/elcl16/stepover_co.png"
                disabledIcon="icons/dlcl16/stepover_co.png"
                label="Skip Command"
                style="push"/>
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.restart"
                icon="icons/elcl16/restart_co.png"
                disabledIcon="icons/dlcl16/restart_co.png"
                label="Clear Execution State"
                style="push"/>
          <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.export"
                icon="icons/elcl16/export_wiz.png"
                disabledIcon="icons/dlcl16/export_wiz.png"
                label="Export Stack"
                style="push"/>
          <command
                commandId="org.yamcs.studio.ui.commanding.stack.import"
                icon="icons/elcl16/import_wiz.gif"
                disabledIcon="icons/dlcl16/import_wiz.gif"
                label="Import a Stack"
                style="push"/>
          <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
      </menuContribution>
      
      <!-- Add icons to the Archive view toolbar -->
      <menuContribution locationURI="toolbar:org.yamcs.studio.ui.archive.ArchiveView">
         <command
               commandId="org.yamcs.studio.ui.archive.refreshCommand"
               icon="icons/elcl16/refresh.png"
               disabledIcon="icons/dlcl16/refresh.png"
               label="Refresh"
               style="push"/>
         <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
         <command
               commandId="org.yamcs.studio.ui.archive.zoomInCommand"
               icon="icons/elcl16/zoom_in.png"
               label="Zoom In"
               style="push"/>
         <command
               commandId="org.yamcs.studio.ui.archive.zoomOutCommand"
               icon="icons/elcl16/zoom_out.png"
               label="Zoom Out"
               style="push"/>
         <command
               commandId="org.yamcs.studio.ui.archive.zoomClearCommand"
               icon="icons/elcl16/zoom_clear.png"
               label="Zoom Out Completely"
               style="push"/>
         <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
         <command
               commandId="org.yamcs.studio.ui.archive.createTagCommand"
               icon="icons/elcl16/tag.gif"
               label="Annotate Selected Range"
               style="push"/>
         <command
               commandId="org.yamcs.studio.ui.archive.createReplayCommand"
               icon="icons/elcl16/replay.png"
               label="Replay Selected Range"
               style="push"/>
      </menuContribution>

      <!-- Add icons to the Event Log view toolbar -->
      <menuContribution locationURI="toolbar:org.yamcs.studio.ui.eventlog.EventLogView">
         <command
               commandId="org.yamcs.studio.ui.eventlog.clearCommand"
               icon="icons/elcl16/clear.png"
               disabledIcon="icons/dlcl16/clear.png"
               label="Clear View"
               style="push"/>
         <command
               commandId="org.yamcs.studio.ui.eventlog.scrollLockCommand"
               icon="icons/elcl16/lock_co.png"
               disabledIcon="icons/dlcl16/lock_co.png"
               label="Scroll Lock"
               style="toggle"/>
         <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
         <command
               commandId="org.yamcs.studio.ui.eventlog.importCommand"
               icon="icons/elcl16/import_wiz.gif"
               disabledIcon="icons/dlcl16/import_wiz.gif"
               label="Import Events"
               style="push"/>
         <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
      </menuContribution>
      
      <!-- Add icons to the Command History view toolbar -->
      <menuContribution locationURI="toolbar:org.yamcs.studio.ui.commanding.cmdhist.CommandHistoryView">
         <command
               commandId="org.yamcs.studio.ui.commanding.cmdhist.clearCommand"
               icon="icons/elcl16/clear.png"
               disabledIcon="icons/dlcl16/clear.png"
               label="Clear View"
               style="push"/>
         <command
               commandId="org.yamcs.studio.ui.commanding.cmdhist.scrollLockCommand"
               icon="icons/elcl16/lock_co.png"
               disabledIcon="icons/dlcl16/lock_co.png"
               label="Scroll Lock"
               style="toggle"/>
         <control class="org.yamcs.studio.ui.ToolbarSpacer"/>
      </menuContribution>
      
      <menuContribution
            allPopups="false"
            locationURI="toolbar:studiocoolbar?after=processorinfo">
         <control id="studiocontributions.processorInfo" class="org.yamcs.studio.ui.processor.ProcessorInfoControlContribution"/>
      </menuContribution>
      
      <!--menuContribution
            allPopups="false"
            locationURI="toolbar:studiocoolbar?after=processorcontrols">
         <!- - Must be outside of toolbar, to trigger the height - ->
         <command
               commandId="org.yamcs.studio.ui.processor.spacer"
               icon="icons/spacer40x32.png"
               tooltip=""
               id="org.yamcs.studio.toolbar.spacer40x32">
         </command>
      </menuContribution-->
      
      <menuContribution
            allPopups="false"
            locationURI="toolbar:org.eclipse.ui.main.toolbar">
         <!-- Commands inside toolbar so that they don't stretch -->
         <toolbar id="controls.processorcontrols">
            <!--command
                  commandId="org.yamcs.studio.ui.processor.goToBeginningCommand"
                  icon="icons/first.png"
                  id="org.yamcs.studio.toolbar.goToBeginningProcessor"
                  tooltip="Step to First Update">
            </command>
            <command
                  commandId="org.yamcs.studio.ui.processor.reverseCommand"
                  icon="icons/reverse.png"
                  id="org.yamcs.studio.toolbar.reverseProcessor"
                  tooltip="Step to Previous Update">
            </command>
            <command
                  commandId="org.yamcs.studio.ui.processor.pauseCommand"
                  icon="icons/pause.png"
                  id="org.yamcs.studio.toolbar.pauseProcessor"
                  tooltip="Pause Processing">
            <visibleWhen>
               <or>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value=""/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="INITIALIZATION"/>
                  </with>
                  <with variable="org.yamcs.studio.ui.processor.state.processing">
                     <equals value="RUNNING"/>
                  </with>
               </or>
            </visibleWhen>
            </command>
            <command
                  commandId="org.yamcs.studio.ui.processor.playCommand"
                  icon="icons/play.png"
                  id="org.yamcs.studio.toolbar.playProcessor"
                  tooltip="Resume Processing">
               <visibleWhen>
                  <or>
                     <with variable="org.yamcs.studio.ui.processor.state.processing">
                        <equals value="STOPPED"/>
                     </with>
                     <with variable="org.yamcs.studio.ui.processor.state.processing">
                        <equals value="ERROR"/>
                     </with>
                     <with variable="org.yamcs.studio.ui.processor.state.processing">
                        <equals value="PAUSED"/>
                     </with>
                     <with variable="org.yamcs.studio.ui.processor.state.processing">
                        <equals value="CLOSED"/>
                     </with>
                  </or>
  	         </visibleWhen>
            </command>
            <command
                  commandId="org.yamcs.studio.ui.processor.forwardCommand"
                  icon="icons/forward.png"
                  id="org.yamcs.studio.toolbar.forwardProcessor"
                  tooltip="Step to Next Update">
            </command>
            <command
                  commandId="org.yamcs.studio.ui.processor.goToEndCommand"
                  icon="icons/last.png"
                  id="org.yamcs.studio.toolbar.goToEndProcessor"
                  tooltip="Step to Last Update">
            </command-->
            <command
                  commandId="org.yamcs.studio.ui.processor.spacer"
                  icon="icons/spacer40x32.png"
                  tooltip=""
                  id="org.yamcs.studio.toolbar.spacer40x32">
            </command>
         </toolbar>
      </menuContribution>
        
      <menuContribution
            allPopups="false"
            locationURI="menu:file?before=user">
            <command
                  commandId="org.yamcs.studio.ui.connect"
                  label="Connect...">
            </command>
            <command
                  commandId="org.yamcs.studio.ui.disconnect" 
                  label="Disconnect">
            </command>
      </menuContribution>
   </extension>
</plugin>
